import winsound

from player import *

# This definitely has to be improved somehow...
_valid_coordinates = [(-250, 280), (-240, 280), (-230, 280), (-220, 280), (-210, 280), (-200, 280), (-190, 280),
                      (-180, 280), (-170, 280), (-160, 280), (-150, 280), (-140, 280), (-130, 280), (-120, 280),
                      (-110, 280), (-100, 280), (-90, 280), (-80, 280), (-70, 280), (-60, 280), (-50, 280),
                      (-40, 280), (-30, 280), (250, 280), (240, 280), (230, 280), (220, 280), (210, 280),
                      (200, 280), (190, 280), (180, 280), (170, 280), (160, 280), (150, 280), (140, 280),
                      (130, 280), (120, 280), (110, 280), (100, 280), (90, 280), (80, 280), (70, 280),
                      (60, 280), (50, 280), (40, 280), (30, 280), (-250, 270), (-250, 260), (-250, 250),
                      (-250, 240), (-250, 230), (-250, 220), (-250, 210), (-250, 200), (-250, 190), (-250, 180),
                      (-250, 170), (-250, 160), (-250, 150), (-250, 140), (-150, 270), (-150, 260), (-150, 250),
                      (-150, 240), (-150, 230), (-150, 130), (-150, 220), (-150, 210), (-150, 200), (-150, 190),
                      (-150, 180), (-150, 170), (-150, 160), (-150, 150), (-150, 140), (-150, 130), (-150, 120),
                      (-150, 110), (-150, 100), (-150, 90), (-150, 80), (-150, 70), (-150, 60), (-150, 50),
                      (-150, 40), (-150, 30), (-150, 20), (-150, 10), (-150, 0), (-150, -10), (-150, -20),
                      (-150, -30), (-150, -40), (-150, -50), (-150, -60), (-150, -70), (-150, -80), (-150, -90),
                      (-150, -100), (-150, -110), (-150, -120), (-150, -130), (-150, -140), (-150, -150), (-150, -160),
                      (-150, -170), (-150, -180), (-150, -190), (-150, -200), (-150, -210), (-150, -220), (-240, 200),
                      (-230, 200), (-220, 200), (-210, 200), (-200, 200), (-190, 200), (-180, 200), (-170, 200),
                      (-160, 200), (-150, 200), (-140, 200), (-130, 200), (-120, 200), (-110, 200), (-100, 200),
                      (-90, 200), (-80, 200), (-70, 200), (-60, 200), (-50, 200), (-40, 200), (-30, 200), (-20, 200),
                      (-10, 200), (0, 200), (10, 200), (20, 200), (30, 200), (40, 200), (50, 200), (60, 200), (70, 200),
                      (80, 200), (90, 200), (100, 200), (110, 200), (120, 200), (130, 200), (140, 200), (150, 200),
                      (160, 200), (170, 200), (180, 200), (190, 200), (200, 200), (210, 200), (220, 200), (230, 200),
                      (240, 200), (250, 200), (-30, 210), (-30, 220), (-30, 230), (-30, 240), (-30, 250), (-30, 260),
                      (-30, 270), (-30, 280), (30, 210), (30, 220), (30, 230), (30, 240), (30, 250), (30, 260),
                      (30, 270), (30, 280), (150, 210), (150, 220), (150, 230), (150, 240), (150, 250), (150, 260),
                      (150, 270), (150, 280), (250, 210), (250, 220), (250, 230), (250, 240), (250, 250), (250, 260),
                      (250, 270), (250, 280), (-240, 140), (-230, 140), (-220, 140), (-210, 140), (-200, 140),
                      (-190, 140), (-180, 140), (-170, 140), (-160, 140), (150, 190), (150, 180), (150, 170),
                      (150, 160), (150, 150), (150, 140), (150, 130), (150, 120), (150, 110), (150, 100), (150, 90),
                      (150, 80), (150, 70), (150, 60), (150, 50), (150, 40), (150, 30), (150, 20), (150, 10), (150, 0),
                      (150, -10), (150, -20), (150, -30), (150, -40), (150, -50), (150, -60), (150, -70), (150, -80),
                      (150, -90), (150, -100), (150, -110), (150, -120), (150, -130), (150, -140), (150, -150),
                      (150, -160), (150, -170), (150, -180), (150, -190), (150, -200), (150, -210), (150, -220),
                      (250, 210), (250, 200), (250, 190), (250, 180), (250, 170), (250, 160), (250, 150), (250, 140),
                      (160, 140), (170, 140), (180, 140), (190, 140), (200, 140), (210, 140), (220, 140), (230, 140),
                      (240, 140), (-150, 20), (-140, 20), (-130, 20), (-120, 20), (-110, 20), (-100, 20), (-90, 20),
                      (-90, 10), (-90, 0), (-90, -10), (-90, -20), (-90, -30), (-90, -40), (-80, -40), (-70, -40),
                      (-60, -40), (-50, -40), (-40, -40), (-30, -40), (-20, -40), (-10, -40), (0, -40), (10, -40),
                      (20, -40), (30, -40), (40, -40), (50, -40), (60, -40), (70, -40), (80, -40), (90, -40), (-90, 30),
                      (-90, 40), (-90, 50), (-90, 60), (-90, 70), (-90, 80), (90, -30), (90, -20), (90, -10), (90, 0),
                      (90, 10), (90, 20), (90, 30), (90, 40), (90, 50), (90, 60), (90, 70), (90, 80), (-80, 80),
                      (-70, 80), (-60, 80), (-50, 80), (-40, 80), (-30, 80), (-20, 80), (-10, 80), (0, 80), (10, 80),
                      (20, 80), (30, 80), (40, 80), (50, 80), (60, 80), (70, 80), (80, 80), (-30, 90), (-30, 100),
                      (-30, 110), (-30, 120), (-30, 130), (-30, 140), (-40, 140), (-50, 140), (-60, 140), (-70, 140),
                      (-80, 140), (-90, 140), (-90, 150), (-90, 160), (-90, 170), (-90, 180), (-90, 190), (100, 20),
                      (110, 20), (120, 20), (130, 20), (140, 20), (30, 90), (30, 100), (30, 110), (30, 120), (30, 130),
                      (30, 140), (40, 140), (50, 140), (60, 140), (70, 140), (80, 140), (90, 140), (90, 150), (90, 160),
                      (90, 170), (90, 180), (90, 190), (90, -50), (90, -60), (90, -70), (90, -80), (90, -90),
                      (90, -100), (100, -100), (110, -100), (120, -100), (130, -100), (140, -100), (-90, -50),
                      (-90, -60), (-90, -70), (-90, -80), (-90, -90), (-90, -100), (-100, -100), (-110, -100),
                      (-130, -100), (-140, -100), (-150, -160), (-140, -160), (-130, -160), (-120, -160), (-110, -160),
                      (-100, -160), (-90, -160), (-80, -160), (-70, -160), (-60, -160), (-50, -160), (-40, -160),
                      (-30, -160), (-20, -160), (-10, -160), (0, -160), (10, -160), (20, -160), (30, -160), (40, -160),
                      (50, -160), (60, -160), (70, -160), (80, -160), (90, -160), (100, -160), (110, -160), (120, -160),
                      (130, -160), (140, -160), (80, -100), (70, -100), (60, -100), (50, -100), (40, -100), (30, -100),
                      (30, -110), (30, -120), (30, -130), (30, -140), (30, -150), (-20, -160), (-30, -150), (-30, -140),
                      (-30, -130), (-30, -120), (-30, -110), (-30, -100), (-40, -100), (-50, -100), (-60, -100),
                      (-70, -100), (-80, -100), (-160, -100), (-170, -100), (-180, -100), (-190, -100), (-200, -100),
                      (-210, -100), (-220, -100), (-230, -100), (-240, -100), (-250, -100), (-250, -110), (-250, -120),
                      (-250, -130), (-250, -140), (-250, -150), (-250, -160), (-240, -160), (-230, -160), (-220, -160),
                      (-210, -160), (-210, -170), (-210, -180), (-210, -190), (-210, -200), (-210, -210), (-210, -220),
                      (-200, -220), (-190, -220), (-180, -220), (-170, -220), (-160, -220), (-220, -220), (-230, -220),
                      (-240, -220), (-250, -220), (-250, -230), (-250, -240), (-250, -250), (-250, -260), (-250, -270),
                      (-250, -280), (-240, -280), (-230, -280), (-220, -280), (-210, -280), (-200, -280), (-190, -280),
                      (-180, -280), (-170, -280), (-160, -280), (-150, -280), (-140, -280), (-130, -280), (-120, -280),
                      (-110, -280), (-100, -280), (-90, -280), (-80, -280), (-70, -280), (-60, -280), (-50, -280),
                      (-40, -280), (-30, -280), (-20, -280), (-10, -280), (0, -280), (10, -280), (20, -280), (30, -280),
                      (40, -280), (50, -280), (60, -280), (70, -280), (80, -280), (90, -280), (100, -280), (110, -280),
                      (120, -280), (130, -280), (140, -280), (150, -280), (160, -280), (170, -280), (180, -280),
                      (190, -280), (200, -280), (210, -280), (220, -280), (230, -280), (240, -280), (250, -280),
                      (250, -270), (250, -260), (250, -250), (250, -240), (250, -230), (250, -220), (240, -220),
                      (230, -220), (220, -220), (210, -220), (200, -220), (190, -220), (180, -220), (170, -220),
                      (160, -220), (-90, -170), (-90, -180), (-90, -190), (-90, -200), (-90, -210), (-90, -220),
                      (-80, -220), (-70, -220), (-60, -220), (-50, -220), (-40, -220), (-30, -220), (-30, -230),
                      (-30, -240), (-30, -250), (-30, -260), (-30, -270), (160, -100), (170, -100), (180, -100),
                      (190, -100), (200, -100), (210, -100), (220, -100), (230, -100), (240, -100), (250, -100),
                      (250, -110), (250, -120), (250, -130), (250, -140), (250, -150), (250, -160), (240, -160),
                      (230, -160), (220, -160), (210, -160), (210, -170), (210, -180), (210, -190), (210, -200),
                      (210, -210), (90, -170), (90, -180), (90, -190), (90, -200), (90, -210), (90, -220), (80, -220),
                      (70, -220), (60, -220), (50, -220), (40, -220), (30, -220), (30, -230), (30, -240), (30, -250),
                      (30, -260), (30, -270), (-120, -100)]
fruit_location = []
fruit = turtle.Turtle()
fruit.speed(0)
fruit.shape("circle")
fruit.color("white")
fruit.turtlesize(0.25)
fruit.penup()


# Direction functions
def go_up():
    _player.direction = "up"


def go_down():
    _player.direction = "down"


def go_left():
    _player.direction = "left"


def go_right():
    _player.direction = "right"


# Move the player according to direction
def move_player():
    x = _player.xcor()
    y = _player.ycor()
    if _player.direction == "up" and y < 280:
        y += 10
        _player.shape("pictures/Pacman_up.gif")
    if _player.direction == "down" and y > -280:
        y -= 10
        _player.shape("pictures/Pacman_down.gif")
    if _player.direction == "left" and x > -250:
        x -= 10
        _player.shape("pictures/Pacman_left.gif")
    if _player.direction == "right" and x < 250:
        x += 10
        _player.shape("pictures/Pacman_right.gif")
    # Refresh coordinates and reset the direction
    if movement_is_valid(x, y):
        _player.x = x
        _player.y = y
        _player.setx(x)
        _player.sety(y)
        i = 0
        for a, b, hasFruit in fruit_location:
            if a == x and b == y and hasFruit:
                _player.score = _player.score + 10
                fruit_location.pop(i)
                fruit.clear()
                refresh_fruits()
                update_score(_player.score)
            i = i + 1
    _player.direction = ""
    _player.has_moved = True


# Check for collision
def check_collision(enemy):
    if enemy.distance(_player) < 20:
        _player.alive = False
        winsound.PlaySound("music/Pacman_lose.wav", winsound.SND_ASYNC)
        print("Game over!")


def movement_is_valid(x_coord, y_coord):
    for x, y in _valid_coordinates:
        if (x == x_coord) and (y == y_coord):
            return True
    return False


def refresh_fruits():
    if len(fruit_location) == 0:
        _player.alive = False
        winsound.PlaySound("music/Pacman_win.wav", winsound.SND_ASYNC)
        print("You win!")
    for x, y, z in fruit_location:
        fruit.goto(x, y)
        fruit.stamp()


def place_fruits():
    i = 0
    for x, y in _valid_coordinates:
        # Skip spawn points
        if x == -10 and y == -40 or x == 0 and y == -40 or x == 10 and y == -40:
            continue
        fruit_location.append([x, y, True])
        fruit.goto(x, y)
        fruit.stamp()


_player = get_player()
